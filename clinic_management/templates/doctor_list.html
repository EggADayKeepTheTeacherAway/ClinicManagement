{% extends 'base.html' %}

{% block title %}
<h2 class="mt-4">Doctor List</h2>
{% endblock %}

{% block content %}
{% load static %}

<link rel="stylesheet" href="{% static 'doctor-table.css' %}">

<div class="container my-4">
  <hr>
  <a href="{% url 'add_doctor' %}" class="btn btn-primary mb-3">Add Doctor</a>
  <table id="doctorsTable" class="table table-striped table-bordered display nowrap" style="width:100%">
    <thead class="table-dark">
      <tr>
        <th>Doctor ID</th>
        <th>Name</th>
        <th>Phone</th>
        <th>Email</th>
        <th>Birthdate</th>
        <th>Specialization</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for doctor in doctors %}
      <tr>
        <td>{{ doctor.DoctorID }}</td>
        <td>
          <button
            type="button"
            class="btn btn-link"
            data-bs-toggle="modal"
            data-bs-target="#scheduleModal"
            data-doctor-name="{{ doctor.Name }}">
            {{ doctor.Name }}
          </button>
        </td>
        <td>{{ doctor.Phone }}</td>
        <td>{{ doctor.Email }}</td>
        <td>{{ doctor.Birthdate }}</td>
        <td>{{ doctor.Specialization }}</td>
        <td>
          <form action="{% url 'delete_doctor' doctor.DoctorID %}" method="POST" style="display:inline;">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Schedule Modal -->
<div class="modal fade" id="scheduleModal" tabindex="-1" aria-labelledby="scheduleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="scheduleModalLabel"><span id="doctorName"></span> Schedule</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="table-responsive">
          <table class="table table-bordered text-center">
            <thead>
              <tr class="bg-light-gray">
                <th class="text-uppercase">Time</th>
                <th class="text-uppercase">Monday</th>
                <th class="text-uppercase">Tuesday</th>
                <th class="text-uppercase">Wednesday</th>
                <th class="text-uppercase">Thursday</th>
                <th class="text-uppercase">Friday</th>
                <th class="text-uppercase">Saturday</th>
              </tr>
            </thead>
            <tbody>
              <!-- Example row; replace with dynamic content -->
              <tr>
                <td>09:00am</td>
                <td><span class="bg-sky padding-5px-tb padding-15px-lr border-radius-5 text-white">Dance</span></td>
                <td><span class="bg-green padding-5px-tb padding-15px-lr border-radius-5 text-white">Yoga</span></td>
                <td><span class="bg-yellow padding-5px-tb padding-15px-lr border-radius-5 text-white">Music</span></td>
                <td><span class="bg-sky padding-5px-tb padding-15px-lr border-radius-5 text-white">Dance</span></td>
                <td><span class="bg-purple padding-5px-tb padding-15px-lr border-radius-5 text-white">Art</span></td>
                <td><span class="bg-pink padding-5px-tb padding-15px-lr border-radius-5 text-white">English</span></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  $(document).ready(function () {
    // Initialize DataTable
    $('#doctorsTable').DataTable({
      responsive: true,
      scrollX: true
    });

    // Update modal header dynamically
    $('#scheduleModal').on('show.bs.modal', function (event) {
      var button = $(event.relatedTarget); // Button that triggered the modal
      var doctorName = button.data('doctor-name'); // Extract name from data-* attribute
      $('#doctorName').text(doctorName); // Update the modal title with the doctor's name
    });
  });
</script>
{% endblock %}
